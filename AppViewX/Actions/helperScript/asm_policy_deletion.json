{"name":"asm_policy_deletion","scriptType":"Python","scriptContent":"import json\nimport sys\nimport os\nimport requests\nimport commands\nimport appviewx\nreload(appviewx)\nimport Decrypt\nreload(Decrypt)\n\ndevice_ip  = sys.argv[1]\ndr_device_list = sys.argv[2]\nasm_policy_name = sys.argv[3]\nusername, password = Decrypt.getpassword(dr_device_list)\n\nBASE_URL = 'https://{dev_ip}/mgmt/tm/asm/policies'.format(dev_ip = device_ip)\nencode_text = 'Basic ' + Decrypt.getencoded(dr_device_list)\npost_header = {'Authorization' : encode_text, 'Content-Type' : 'application/json'}\n\ndef get_hash_code():\n\t'''Get hash code for the created policy'''\n\tglobal hash_code\n\theaders = {'content-type': 'application/json'}\n\tresponse = requests.get('https://'+device_ip+'/mgmt/tm/asm/policies/', auth=(''+username+'', ''+password+''), headers=headers,verify=False)\n\tl = json.loads(response.content)\n\tls = { i['name']:i['id'] for i in l['items']}\n\thash_code = ls[asm_policy_name]\n\ndef delete_policy():\n\t'''Delete the created ASM Policy'''\n\tdelete_policy_api = '{base_url}/{hashcode}'.format(base_url = BASE_URL , hashcode = hash_code)\n\tdelete_policy_curl = 'curl -k1 -H \"Authorization:' + encode_text + '\"' + ' -H \"Content-Type:application/json\" -X DELETE ' + delete_policy_api\n\tstatus, output = commands.getstatusoutput(delete_policy_curl)\n\tprint status\n\nif __name__ == '__main__' :\n\t'''main'''\n\tget_hash_code()\n\tdelete_policy()\n","description":"","readOnly":false,"version":"Version 2.x","historyReferences":[],"usedHistory":null,"sourceControlSettings":null,"_id":"asm_policy_deletion","_keywords":["asm_policy_deletion","","Version 2.x"]}